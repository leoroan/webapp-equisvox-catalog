<!doctype html>
<html lang="es">

<head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>Proyecto | Ofertas</title>

    <!-- Bootstrap -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.8/dist/css/bootstrap.min.css" rel="stylesheet">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap-icons/font/bootstrap-icons.css" rel="stylesheet">

    <!-- Fonts -->
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500&family=Poppins:wght@500;600&display=swap"
        rel="stylesheet">

    <style>
        :root {
            --bg-main: #0f172a;
            /* azul oscuro */
            --bg-card: #1e293b;
            /* slate */
            --bg-soft: #312e81;
            /* violeta suave */
            --txt-main: #e5e7eb;
            --txt-muted: #94a3b8;
            --accent: #38bdf8;
            /* azul pastel */
        }

        body {
            background: linear-gradient(135deg, var(--bg-main), var(--bg-soft));
            font-family: Inter, sans-serif;
            color: var(--txt-main);
            min-height: 100vh;
        }

        h1,
        h2,
        h3 {
            font-family: Poppins, sans-serif;
        }

        /* Layout */
        .app-layout {
            display: grid;
            grid-template-columns: 260px 1fr;
            gap: 1rem;
        }

        @media (max-width: 992px) {
            .app-layout {
                grid-template-columns: 1fr;
            }
        }

        /* Filters */
        .filters {
            background: rgba(30, 41, 59, 0.85);
            border-radius: 0.75rem;
            padding: 1rem;
        }

        /* Cards (compactas, casi tabla) */
        .game-card {
            background: var(--bg-card);
            border-radius: 0.5rem;
            padding: 0.5rem 0.75rem;
            display: grid;
            grid-template-columns: 48px 1fr auto;
            gap: 0.75rem;
            align-items: center;
            font-size: 0.85rem;
        }

        .game-card img {
            width: 48px;
            height: 48px;
            object-fit: cover;
            border-radius: 0.25rem;
        }

        .price-old {
            text-decoration: line-through;
            color: var(--txt-muted);
            font-size: 0.75rem;
        }

        .discount {
            color: #4ade80;
            font-weight: 600;
            font-size: 0.75rem;
        }

        .pagination .page-link {
            background: var(--bg-card);
            color: var(--txt-main);
            border: none;
        }

        .pagination .page-item.active .page-link {
            background: var(--accent);
            color: #020617;
        }
    </style>
</head>

<body>

    <main class="container-fluid py-4">
        <h1 class="mb-4">Ofertas disponibles</h1>

        <section class="app-layout">
            <!-- Filters -->
            <aside class="filters">
                <h6 class="mb-3">Filtros</h6>

                <div class="mb-2">
                    <label class="form-label form-label-sm">Buscar</label>
                    <input id="filterText" type="text" class="form-control form-control-sm" placeholder="Título…">
                </div>

                <div class="mb-2">
                    <label class="form-label form-label-sm">Descuento mínimo</label>
                    <input id="filterDiscount" type="number" class="form-control form-control-sm" value="0">
                </div>
            </aside>

            <!-- Content -->
            <section>
                <div id="cards" class="d-grid gap-2"></div>

                <nav class="mt-3">
                    <ul id="pagination" class="pagination pagination-sm"></ul>
                </nav>
            </section>
        </section>
    </main>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.8/dist/js/bootstrap.bundle.min.js"></script>

    <script>
        /* ================================
           Data Source Abstraction
           CSV hoy / API mañana
        ================================= */
        class DataSource {
            async fetch() { throw new Error('Not implemented'); }
        }

        class CsvDataSource extends DataSource {
            constructor(url) {
                super();
                this.url = url;
            }

            async fetch() {
                const res = await fetch(this.url);
                if (!res.ok) throw new Error('No se pudo cargar el CSV');

                const csvText = await res.text();
                const [header, ...rows] = csvText.trim().split('\n');
                const keys = header.split(',');

                return rows.map(row => {
                    const values = row.split(/,(?=(?:[^\"]*\"[^\"]*\")*[^\"]*$)/);
                    return Object.fromEntries(
                        keys.map((k, i) => [
                            k,
                            values[i]?.replace(/\"/g, '').trim()
                        ])
                    );
                });
            }
        }

        /* ================================
           State
        ================================= */
        const state = {
            data: [],
            filtered: [],
            page: 1,
            perPage: 8
        };

        /* ================================
           Rendering
        ================================= */
        function renderCards() {
            const container = document.getElementById('cards');
            container.innerHTML = '';

            const start = (state.page - 1) * state.perPage;
            const pageData = state.filtered.slice(start, start + state.perPage);

            pageData.forEach(item => {
                const el = document.createElement('div');
                el.className = 'game-card';
                el.innerHTML = `
          <img src="${item['Image URL']}" alt="">
          <div>
            <strong>${item.Title}</strong><br>
            <span class="price-old">$${item['Original Price']}</span>
            <span class="ms-2">$${item['Current Price']}</span>
            <span class="discount ms-2">-${item['Discount %']}</span>
          </div>
          <a href="${item.URL}" target="_blank" class="btn btn-sm btn-outline-info">Ver</a>
        `;
                container.appendChild(el);
            });
        }

        function renderPagination() {
            const totalPages = Math.ceil(state.filtered.length / state.perPage);
            const ul = document.getElementById('pagination');
            ul.innerHTML = '';

            for (let i = 1; i <= totalPages; i++) {
                const li = document.createElement('li');
                li.className = `page-item ${i === state.page ? 'active' : ''}`;
                li.innerHTML = `<button class="page-link">${i}</button>`;
                li.onclick = () => {
                    state.page = i;
                    renderCards();
                    renderPagination();
                };
                ul.appendChild(li);
            }
        }

        /* ================================
           Filters
        ================================= */
        function applyFilters() {
            const text = document.getElementById('filterText').value.toLowerCase();
            const minDiscount = Number(document.getElementById('filterDiscount').value || 0);

            state.filtered = state.data.filter(item => {
                const discount = parseFloat(item['Discount %']);
                return item.Title.toLowerCase().includes(text) && discount >= minDiscount;
            });

            state.page = 1;
            renderCards();
            renderPagination();
        }

        /* ================================
           Bootstrap
        ================================= */
        async function init() {
            const csv = `ID,Title,Original Price,Current Price,Discount %,Offer,URL,Image URL
9pnvdqkpjrqv,SILENT HILL 2,79999.0,39999.5,50.00%,Ahorra,https://www.xbox.com/es-ar/games/store/silent-hill-2/9pnvdqkpjrqv,https://store-images.s-microsoft.com/image/apps.46297.14341421973666013.292233f8-d8a7-4ef0-bb49-824c7b2154f4.81d7f7ad-4f3e-4936-a29c-a076fe289fab`;

            const source = new CsvDataSource('./sample_data.csv');
            state.data = await source.fetch();
            state.filtered = [...state.data];

            document.getElementById('filterText').addEventListener('input', applyFilters);
            document.getElementById('filterDiscount').addEventListener('input', applyFilters);

            renderCards();
            renderPagination();
        }

        init();
    </script>
</body>

</html>